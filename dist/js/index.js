!function(s,n){function t(t){this.wrap=t,this.dataList=[],this.indexObj=null,this.rotateTimer=null,this.list=null}t.prototype={init:function(){this.getDom(),this.getData("../mock/data.json")},getDom:function(){this.record=document.querySelector(".songImg img"),this.controlBtns=document.querySelectorAll(".control li")},getData:function(t){var i=this;s.ajax({url:t,method:"get",success:function(t){i.dataList=t,i.indexObj=new n.indexControl(t.length),i.listPlay(),i.loadMusic(i.indexObj.curIndex),i.controlMusic()},error:function(){}})},loadMusic:function(t){var i=this;n.render(this.dataList[t]),n.music.loadMusic(this.dataList[t].audioSrc),n.music.endMusicEvent(function(){n.music.status="play",i.loadMusic(i.indexObj.next())}),n.progress.initTotalTime(this.dataList[t].duration),"play"===n.music.status&&(n.music.playMusic(),this.controlBtns[2].className="playing",this.imgRotate(0),n.progress.start()),this.list.changeSelect(t)},controlMusic:function(){var i=this;this.controlBtns[1].addEventListener("touchend",function(t){n.music.status="play",i.loadMusic(i.indexObj.prev())}),this.controlBtns[2].addEventListener("touchend",function(t){"play"===n.music.status?(n.music.pauseMusic(),n.music.status="pause",this.className="",i.imgStop(),n.progress.stop()):(n.music.playMusic(),n.music.status="play",this.className="playing",i.imgRotate(i.record.dataset.rotate||0),n.progress.start())}),this.controlBtns[3].addEventListener("touchend",function(t){n.music.status="play",i.loadMusic(i.indexObj.next())})},imgRotate:function(t){var i=this;clearInterval(this.rotateTimer),this.rotateTimer=setInterval(function(){t=+t+.2,i.record.style.transform="rotate("+t+"deg)",i.record.dataset.rotate=t},1e3/60)},imgStop:function(){clearInterval(this.rotateTimer),this.rotateTimer=null},listPlay:function(){this.list=n.listControl(this.dataList,this.wrap);var s=this;this.controlBtns[4].addEventListener("touchend",function(){s.list.slideUp()}),this.list.musicList.forEach(function(t,i){t.addEventListener("touchend",function(){s.indexObj.curIndex===i||(n.music.status="play",s.indexObj.curIndex=i,s.loadMusic(i),s.list.slideDown())})})}},new t(document.getElementById("wrap")).init()}(window.Zepto,window.player);